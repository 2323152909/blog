<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Node与底层之间如何执行异步I/O调用 | Coderlhd的博客</title>
    <meta name="generator" content="VuePress 1.9.9">
    <link rel="icon" href="/blog/favicon.ico">
    <link rel="manifest" href="/blog/manifest.json">
    <link rel="stylesheet" href="https://at.alicdn.com/t/font_3077305_pt8umhrn4k9.css">
    <meta name="description" content="专注 Web 技术栈分享，从原生JS到Vue再到React,然后Node.js的express到koa。">
    <meta charset="UTF-8">
    
    <link rel="preload" href="/blog/assets/css/0.styles.b17ddfa4.css" as="style"><link rel="preload" href="/blog/assets/js/app.200a69ba.js" as="script"><link rel="preload" href="/blog/assets/js/2.63aefd49.js" as="script"><link rel="preload" href="/blog/assets/js/61.6fb6de0d.js" as="script"><link rel="preload" href="/blog/assets/js/5.324b4591.js" as="script"><link rel="preload" href="/blog/assets/js/8.19393a5e.js" as="script"><link rel="prefetch" href="/blog/assets/js/10.3d100536.js"><link rel="prefetch" href="/blog/assets/js/100.1a08431e.js"><link rel="prefetch" href="/blog/assets/js/101.9503afdc.js"><link rel="prefetch" href="/blog/assets/js/102.9f2aba27.js"><link rel="prefetch" href="/blog/assets/js/103.6daff8b5.js"><link rel="prefetch" href="/blog/assets/js/104.148cb874.js"><link rel="prefetch" href="/blog/assets/js/105.72eb33b9.js"><link rel="prefetch" href="/blog/assets/js/106.818740af.js"><link rel="prefetch" href="/blog/assets/js/107.71e9460e.js"><link rel="prefetch" href="/blog/assets/js/108.95d51886.js"><link rel="prefetch" href="/blog/assets/js/109.0ab6ac1e.js"><link rel="prefetch" href="/blog/assets/js/11.455f2da7.js"><link rel="prefetch" href="/blog/assets/js/110.c9c029ed.js"><link rel="prefetch" href="/blog/assets/js/111.248523ee.js"><link rel="prefetch" href="/blog/assets/js/112.4d0e94ec.js"><link rel="prefetch" href="/blog/assets/js/113.94efd705.js"><link rel="prefetch" href="/blog/assets/js/114.8c412a51.js"><link rel="prefetch" href="/blog/assets/js/115.06c8cfef.js"><link rel="prefetch" href="/blog/assets/js/116.016ee6f6.js"><link rel="prefetch" href="/blog/assets/js/117.988d3962.js"><link rel="prefetch" href="/blog/assets/js/118.4a6df475.js"><link rel="prefetch" href="/blog/assets/js/119.08724fa1.js"><link rel="prefetch" href="/blog/assets/js/12.b47b6ab5.js"><link rel="prefetch" href="/blog/assets/js/120.df6ae9bf.js"><link rel="prefetch" href="/blog/assets/js/121.44720d19.js"><link rel="prefetch" href="/blog/assets/js/122.aa49a61e.js"><link rel="prefetch" href="/blog/assets/js/123.35c68179.js"><link rel="prefetch" href="/blog/assets/js/124.79ad7638.js"><link rel="prefetch" href="/blog/assets/js/125.94bc6202.js"><link rel="prefetch" href="/blog/assets/js/126.0cc62d14.js"><link rel="prefetch" href="/blog/assets/js/127.0a23cf1d.js"><link rel="prefetch" href="/blog/assets/js/128.14384bbf.js"><link rel="prefetch" href="/blog/assets/js/129.90e0980a.js"><link rel="prefetch" href="/blog/assets/js/13.cc89c95f.js"><link rel="prefetch" href="/blog/assets/js/130.abb45748.js"><link rel="prefetch" href="/blog/assets/js/131.22686006.js"><link rel="prefetch" href="/blog/assets/js/132.f56d1b55.js"><link rel="prefetch" href="/blog/assets/js/133.1072c213.js"><link rel="prefetch" href="/blog/assets/js/134.c89db979.js"><link rel="prefetch" href="/blog/assets/js/135.605de625.js"><link rel="prefetch" href="/blog/assets/js/136.695156a5.js"><link rel="prefetch" href="/blog/assets/js/137.88e6ebbb.js"><link rel="prefetch" href="/blog/assets/js/138.2920dfa2.js"><link rel="prefetch" href="/blog/assets/js/139.96f84622.js"><link rel="prefetch" href="/blog/assets/js/14.3599157a.js"><link rel="prefetch" href="/blog/assets/js/140.ade16920.js"><link rel="prefetch" href="/blog/assets/js/141.fd12a5ff.js"><link rel="prefetch" href="/blog/assets/js/142.4e8fd66b.js"><link rel="prefetch" href="/blog/assets/js/143.2c8fb70a.js"><link rel="prefetch" href="/blog/assets/js/144.c405d4f3.js"><link rel="prefetch" href="/blog/assets/js/145.8dc3561d.js"><link rel="prefetch" href="/blog/assets/js/146.faf1606a.js"><link rel="prefetch" href="/blog/assets/js/147.e4c717d0.js"><link rel="prefetch" href="/blog/assets/js/148.fb2ec70e.js"><link rel="prefetch" href="/blog/assets/js/149.a51a4233.js"><link rel="prefetch" href="/blog/assets/js/15.74c412a5.js"><link rel="prefetch" href="/blog/assets/js/150.7350912b.js"><link rel="prefetch" href="/blog/assets/js/151.16563652.js"><link rel="prefetch" href="/blog/assets/js/152.50d1c355.js"><link rel="prefetch" href="/blog/assets/js/153.651b4a1d.js"><link rel="prefetch" href="/blog/assets/js/154.c6b9e409.js"><link rel="prefetch" href="/blog/assets/js/155.0a62d323.js"><link rel="prefetch" href="/blog/assets/js/156.258d2d55.js"><link rel="prefetch" href="/blog/assets/js/157.893b5d30.js"><link rel="prefetch" href="/blog/assets/js/158.fd098d37.js"><link rel="prefetch" href="/blog/assets/js/159.ac5e1058.js"><link rel="prefetch" href="/blog/assets/js/16.fb44b67a.js"><link rel="prefetch" href="/blog/assets/js/160.26a7d22f.js"><link rel="prefetch" href="/blog/assets/js/161.dc2bb40d.js"><link rel="prefetch" href="/blog/assets/js/162.1724c7c4.js"><link rel="prefetch" href="/blog/assets/js/163.51d93ac0.js"><link rel="prefetch" href="/blog/assets/js/164.dc4864e2.js"><link rel="prefetch" href="/blog/assets/js/165.3fd6d1f7.js"><link rel="prefetch" href="/blog/assets/js/166.66e7d9a6.js"><link rel="prefetch" href="/blog/assets/js/167.64751cd7.js"><link rel="prefetch" href="/blog/assets/js/168.4f1cceac.js"><link rel="prefetch" href="/blog/assets/js/169.ce1303b2.js"><link rel="prefetch" href="/blog/assets/js/17.24474186.js"><link rel="prefetch" href="/blog/assets/js/170.269da2bb.js"><link rel="prefetch" href="/blog/assets/js/171.6dd6d9dc.js"><link rel="prefetch" href="/blog/assets/js/172.5c1edb12.js"><link rel="prefetch" href="/blog/assets/js/173.974164b1.js"><link rel="prefetch" href="/blog/assets/js/174.507e4d9d.js"><link rel="prefetch" href="/blog/assets/js/175.28ed103d.js"><link rel="prefetch" href="/blog/assets/js/176.aa9bd0ef.js"><link rel="prefetch" href="/blog/assets/js/177.492aa57f.js"><link rel="prefetch" href="/blog/assets/js/178.78503364.js"><link rel="prefetch" href="/blog/assets/js/179.6c8ae10c.js"><link rel="prefetch" href="/blog/assets/js/18.66103d59.js"><link rel="prefetch" href="/blog/assets/js/180.9ab97e31.js"><link rel="prefetch" href="/blog/assets/js/181.5a537a47.js"><link rel="prefetch" href="/blog/assets/js/182.b9d5b609.js"><link rel="prefetch" href="/blog/assets/js/183.7cb0e8f5.js"><link rel="prefetch" href="/blog/assets/js/184.7ab9d135.js"><link rel="prefetch" href="/blog/assets/js/185.19b1b709.js"><link rel="prefetch" href="/blog/assets/js/186.b486c7bc.js"><link rel="prefetch" href="/blog/assets/js/187.1b26ddba.js"><link rel="prefetch" href="/blog/assets/js/188.7bac1889.js"><link rel="prefetch" href="/blog/assets/js/189.05282bbe.js"><link rel="prefetch" href="/blog/assets/js/19.5848f7b7.js"><link rel="prefetch" href="/blog/assets/js/190.6dac73ba.js"><link rel="prefetch" href="/blog/assets/js/191.abb92673.js"><link rel="prefetch" href="/blog/assets/js/192.b05fd997.js"><link rel="prefetch" href="/blog/assets/js/193.ad1026ce.js"><link rel="prefetch" href="/blog/assets/js/194.2f6ad97e.js"><link rel="prefetch" href="/blog/assets/js/195.016212c7.js"><link rel="prefetch" href="/blog/assets/js/196.6ab988b4.js"><link rel="prefetch" href="/blog/assets/js/197.ab54c706.js"><link rel="prefetch" href="/blog/assets/js/198.2e739beb.js"><link rel="prefetch" href="/blog/assets/js/199.807d8a0a.js"><link rel="prefetch" href="/blog/assets/js/20.2b65ff79.js"><link rel="prefetch" href="/blog/assets/js/200.ba8fa7f9.js"><link rel="prefetch" href="/blog/assets/js/201.97690cc5.js"><link rel="prefetch" href="/blog/assets/js/202.1476f86f.js"><link rel="prefetch" href="/blog/assets/js/203.e97e1fea.js"><link rel="prefetch" href="/blog/assets/js/204.eb46eea1.js"><link rel="prefetch" href="/blog/assets/js/205.3d1ea928.js"><link rel="prefetch" href="/blog/assets/js/206.10e9560d.js"><link rel="prefetch" href="/blog/assets/js/207.4b9100ab.js"><link rel="prefetch" href="/blog/assets/js/208.63b29630.js"><link rel="prefetch" href="/blog/assets/js/209.5b76e1c4.js"><link rel="prefetch" href="/blog/assets/js/21.2ff79d32.js"><link rel="prefetch" href="/blog/assets/js/210.0dd682a4.js"><link rel="prefetch" href="/blog/assets/js/211.34875837.js"><link rel="prefetch" href="/blog/assets/js/212.88f228e9.js"><link rel="prefetch" href="/blog/assets/js/213.bc341cee.js"><link rel="prefetch" href="/blog/assets/js/214.0f5a9039.js"><link rel="prefetch" href="/blog/assets/js/215.cd27a0bb.js"><link rel="prefetch" href="/blog/assets/js/216.f5ef1314.js"><link rel="prefetch" href="/blog/assets/js/217.f2185f41.js"><link rel="prefetch" href="/blog/assets/js/218.2ab3a2da.js"><link rel="prefetch" href="/blog/assets/js/219.6a473126.js"><link rel="prefetch" href="/blog/assets/js/22.2dc97a90.js"><link rel="prefetch" href="/blog/assets/js/220.5d02c6dd.js"><link rel="prefetch" href="/blog/assets/js/221.8271ee40.js"><link rel="prefetch" href="/blog/assets/js/222.a3a3fb89.js"><link rel="prefetch" href="/blog/assets/js/223.10cb57ef.js"><link rel="prefetch" href="/blog/assets/js/224.095d8866.js"><link rel="prefetch" href="/blog/assets/js/225.3b8509ab.js"><link rel="prefetch" href="/blog/assets/js/226.130162f5.js"><link rel="prefetch" href="/blog/assets/js/227.6c73762d.js"><link rel="prefetch" href="/blog/assets/js/228.9940c90d.js"><link rel="prefetch" href="/blog/assets/js/229.1daf466a.js"><link rel="prefetch" href="/blog/assets/js/23.1837769c.js"><link rel="prefetch" href="/blog/assets/js/230.9e6fb012.js"><link rel="prefetch" href="/blog/assets/js/231.466e427f.js"><link rel="prefetch" href="/blog/assets/js/232.20c905a6.js"><link rel="prefetch" href="/blog/assets/js/233.cb91dc28.js"><link rel="prefetch" href="/blog/assets/js/234.81af1acd.js"><link rel="prefetch" href="/blog/assets/js/235.b56986a4.js"><link rel="prefetch" href="/blog/assets/js/236.efe5e840.js"><link rel="prefetch" href="/blog/assets/js/237.3c73912a.js"><link rel="prefetch" href="/blog/assets/js/238.b1dbae18.js"><link rel="prefetch" href="/blog/assets/js/239.ed8d940e.js"><link rel="prefetch" href="/blog/assets/js/24.dcca7e47.js"><link rel="prefetch" href="/blog/assets/js/240.194eab6a.js"><link rel="prefetch" href="/blog/assets/js/241.e4477ea6.js"><link rel="prefetch" href="/blog/assets/js/242.810db707.js"><link rel="prefetch" href="/blog/assets/js/243.c9aefcff.js"><link rel="prefetch" href="/blog/assets/js/244.2a02632f.js"><link rel="prefetch" href="/blog/assets/js/245.b1f4cf41.js"><link rel="prefetch" href="/blog/assets/js/246.ba749e75.js"><link rel="prefetch" href="/blog/assets/js/247.84ebefdc.js"><link rel="prefetch" href="/blog/assets/js/248.67e8b97b.js"><link rel="prefetch" href="/blog/assets/js/249.68177d68.js"><link rel="prefetch" href="/blog/assets/js/25.e50892b2.js"><link rel="prefetch" href="/blog/assets/js/250.58367b28.js"><link rel="prefetch" href="/blog/assets/js/251.09a1fa6b.js"><link rel="prefetch" href="/blog/assets/js/252.aefd0493.js"><link rel="prefetch" href="/blog/assets/js/253.ea1ec997.js"><link rel="prefetch" href="/blog/assets/js/254.3d1e05f5.js"><link rel="prefetch" href="/blog/assets/js/255.270b6f68.js"><link rel="prefetch" href="/blog/assets/js/256.726c5a4f.js"><link rel="prefetch" href="/blog/assets/js/257.9f1ac00c.js"><link rel="prefetch" href="/blog/assets/js/258.30185e8c.js"><link rel="prefetch" href="/blog/assets/js/259.12b621be.js"><link rel="prefetch" href="/blog/assets/js/26.0dc253fe.js"><link rel="prefetch" href="/blog/assets/js/260.713a6b5b.js"><link rel="prefetch" href="/blog/assets/js/261.8e79a569.js"><link rel="prefetch" href="/blog/assets/js/262.001f252d.js"><link rel="prefetch" href="/blog/assets/js/263.a1fbce39.js"><link rel="prefetch" href="/blog/assets/js/264.7015995c.js"><link rel="prefetch" href="/blog/assets/js/265.a27056a3.js"><link rel="prefetch" href="/blog/assets/js/266.9c07127b.js"><link rel="prefetch" href="/blog/assets/js/267.b1337e81.js"><link rel="prefetch" href="/blog/assets/js/268.5d91a070.js"><link rel="prefetch" href="/blog/assets/js/269.0e1b7ae4.js"><link rel="prefetch" href="/blog/assets/js/27.2f28a5b4.js"><link rel="prefetch" href="/blog/assets/js/270.5bd5dcdb.js"><link rel="prefetch" href="/blog/assets/js/271.11be069c.js"><link rel="prefetch" href="/blog/assets/js/272.71c67b25.js"><link rel="prefetch" href="/blog/assets/js/273.8c93f1d6.js"><link rel="prefetch" href="/blog/assets/js/274.2e3be4d9.js"><link rel="prefetch" href="/blog/assets/js/275.00fd414e.js"><link rel="prefetch" href="/blog/assets/js/276.2c03d100.js"><link rel="prefetch" href="/blog/assets/js/277.8ed62973.js"><link rel="prefetch" href="/blog/assets/js/278.a3f2f49c.js"><link rel="prefetch" href="/blog/assets/js/279.ece06b57.js"><link rel="prefetch" href="/blog/assets/js/28.9c7368fe.js"><link rel="prefetch" href="/blog/assets/js/280.49c3f4d0.js"><link rel="prefetch" href="/blog/assets/js/281.327e8cd4.js"><link rel="prefetch" href="/blog/assets/js/282.5d99cdd0.js"><link rel="prefetch" href="/blog/assets/js/283.79d5f8ac.js"><link rel="prefetch" href="/blog/assets/js/284.a0dca640.js"><link rel="prefetch" href="/blog/assets/js/285.317b76d8.js"><link rel="prefetch" href="/blog/assets/js/286.a46aa31f.js"><link rel="prefetch" href="/blog/assets/js/287.6b7bea11.js"><link rel="prefetch" href="/blog/assets/js/288.c0d917ee.js"><link rel="prefetch" href="/blog/assets/js/289.504a44dc.js"><link rel="prefetch" href="/blog/assets/js/29.b5ec258c.js"><link rel="prefetch" href="/blog/assets/js/290.f7de549c.js"><link rel="prefetch" href="/blog/assets/js/291.b9f7433a.js"><link rel="prefetch" href="/blog/assets/js/292.dd866736.js"><link rel="prefetch" href="/blog/assets/js/293.b71d7490.js"><link rel="prefetch" href="/blog/assets/js/294.1f9f574e.js"><link rel="prefetch" href="/blog/assets/js/295.54dac78a.js"><link rel="prefetch" href="/blog/assets/js/296.878e45c0.js"><link rel="prefetch" href="/blog/assets/js/297.ce898c9e.js"><link rel="prefetch" href="/blog/assets/js/298.9bdfa062.js"><link rel="prefetch" href="/blog/assets/js/299.16d2de04.js"><link rel="prefetch" href="/blog/assets/js/3.881e0ce8.js"><link rel="prefetch" href="/blog/assets/js/30.8efc2530.js"><link rel="prefetch" href="/blog/assets/js/300.c0880c0e.js"><link rel="prefetch" href="/blog/assets/js/301.7b268dcb.js"><link rel="prefetch" href="/blog/assets/js/302.582732d9.js"><link rel="prefetch" href="/blog/assets/js/303.b2067269.js"><link rel="prefetch" href="/blog/assets/js/304.7cd83624.js"><link rel="prefetch" href="/blog/assets/js/305.67244687.js"><link rel="prefetch" href="/blog/assets/js/306.4118a7f7.js"><link rel="prefetch" href="/blog/assets/js/307.85108d08.js"><link rel="prefetch" href="/blog/assets/js/308.ed7e4f9f.js"><link rel="prefetch" href="/blog/assets/js/309.fc144f35.js"><link rel="prefetch" href="/blog/assets/js/31.f19b6244.js"><link rel="prefetch" href="/blog/assets/js/310.a8f5f395.js"><link rel="prefetch" href="/blog/assets/js/311.063f1960.js"><link rel="prefetch" href="/blog/assets/js/312.6cf54daf.js"><link rel="prefetch" href="/blog/assets/js/313.46b443e4.js"><link rel="prefetch" href="/blog/assets/js/314.3b91f616.js"><link rel="prefetch" href="/blog/assets/js/315.106b4c0a.js"><link rel="prefetch" href="/blog/assets/js/316.2efe92f3.js"><link rel="prefetch" href="/blog/assets/js/317.8c97645e.js"><link rel="prefetch" href="/blog/assets/js/318.77a1b711.js"><link rel="prefetch" href="/blog/assets/js/319.9b571b02.js"><link rel="prefetch" href="/blog/assets/js/32.328afecb.js"><link rel="prefetch" href="/blog/assets/js/320.8695e2b3.js"><link rel="prefetch" href="/blog/assets/js/321.2b04c9b9.js"><link rel="prefetch" href="/blog/assets/js/322.7c634f31.js"><link rel="prefetch" href="/blog/assets/js/323.d3fda6d1.js"><link rel="prefetch" href="/blog/assets/js/324.00f1fc8f.js"><link rel="prefetch" href="/blog/assets/js/325.1ef66c2e.js"><link rel="prefetch" href="/blog/assets/js/326.493a5268.js"><link rel="prefetch" href="/blog/assets/js/327.fb7fa5af.js"><link rel="prefetch" href="/blog/assets/js/328.1029cc88.js"><link rel="prefetch" href="/blog/assets/js/329.ba832a97.js"><link rel="prefetch" href="/blog/assets/js/33.143a1451.js"><link rel="prefetch" href="/blog/assets/js/330.45e5bbf6.js"><link rel="prefetch" href="/blog/assets/js/331.138229ac.js"><link rel="prefetch" href="/blog/assets/js/332.bda8e68f.js"><link rel="prefetch" href="/blog/assets/js/333.7b667399.js"><link rel="prefetch" href="/blog/assets/js/334.344e6928.js"><link rel="prefetch" href="/blog/assets/js/335.90b37bbe.js"><link rel="prefetch" href="/blog/assets/js/336.a1d0f2db.js"><link rel="prefetch" href="/blog/assets/js/337.ab2bea14.js"><link rel="prefetch" href="/blog/assets/js/338.b402fc7b.js"><link rel="prefetch" href="/blog/assets/js/339.ab2223b7.js"><link rel="prefetch" href="/blog/assets/js/34.27687e56.js"><link rel="prefetch" href="/blog/assets/js/340.8faad263.js"><link rel="prefetch" href="/blog/assets/js/341.a2b709f5.js"><link rel="prefetch" href="/blog/assets/js/342.9f620fbb.js"><link rel="prefetch" href="/blog/assets/js/343.b10f27a0.js"><link rel="prefetch" href="/blog/assets/js/344.9712ab66.js"><link rel="prefetch" href="/blog/assets/js/345.0aedac8c.js"><link rel="prefetch" href="/blog/assets/js/346.09e987d7.js"><link rel="prefetch" href="/blog/assets/js/347.77034dff.js"><link rel="prefetch" href="/blog/assets/js/348.b3b44c74.js"><link rel="prefetch" href="/blog/assets/js/349.669a6bd3.js"><link rel="prefetch" href="/blog/assets/js/35.a062359f.js"><link rel="prefetch" href="/blog/assets/js/350.1f3e4c7a.js"><link rel="prefetch" href="/blog/assets/js/351.1d561a88.js"><link rel="prefetch" href="/blog/assets/js/352.68d6babd.js"><link rel="prefetch" href="/blog/assets/js/353.107f0ab8.js"><link rel="prefetch" href="/blog/assets/js/354.37431647.js"><link rel="prefetch" href="/blog/assets/js/355.5fc5a974.js"><link rel="prefetch" href="/blog/assets/js/356.799dab2f.js"><link rel="prefetch" href="/blog/assets/js/357.9020ba49.js"><link rel="prefetch" href="/blog/assets/js/358.55a16280.js"><link rel="prefetch" href="/blog/assets/js/359.dcc8edcb.js"><link rel="prefetch" href="/blog/assets/js/36.5ac5e444.js"><link rel="prefetch" href="/blog/assets/js/360.1dfbc592.js"><link rel="prefetch" href="/blog/assets/js/361.ae2fa300.js"><link rel="prefetch" href="/blog/assets/js/362.1998b988.js"><link rel="prefetch" href="/blog/assets/js/363.02b5d070.js"><link rel="prefetch" href="/blog/assets/js/364.c245da19.js"><link rel="prefetch" href="/blog/assets/js/365.e03846bd.js"><link rel="prefetch" href="/blog/assets/js/366.f281f551.js"><link rel="prefetch" href="/blog/assets/js/367.68d0ad29.js"><link rel="prefetch" href="/blog/assets/js/37.21f6ee44.js"><link rel="prefetch" href="/blog/assets/js/38.352b2a7a.js"><link rel="prefetch" href="/blog/assets/js/39.7b9b98ca.js"><link rel="prefetch" href="/blog/assets/js/4.665c5f91.js"><link rel="prefetch" href="/blog/assets/js/40.04d1728e.js"><link rel="prefetch" href="/blog/assets/js/41.94f396c0.js"><link rel="prefetch" href="/blog/assets/js/42.bb75e040.js"><link rel="prefetch" href="/blog/assets/js/43.6f494bae.js"><link rel="prefetch" href="/blog/assets/js/44.72936aef.js"><link rel="prefetch" href="/blog/assets/js/45.bcba3416.js"><link rel="prefetch" href="/blog/assets/js/46.d30a42cd.js"><link rel="prefetch" href="/blog/assets/js/47.a6463f0c.js"><link rel="prefetch" href="/blog/assets/js/48.64cda375.js"><link rel="prefetch" href="/blog/assets/js/49.5f91f6e3.js"><link rel="prefetch" href="/blog/assets/js/50.da9f852a.js"><link rel="prefetch" href="/blog/assets/js/51.77a8e741.js"><link rel="prefetch" href="/blog/assets/js/52.49301920.js"><link rel="prefetch" href="/blog/assets/js/53.68228d5e.js"><link rel="prefetch" href="/blog/assets/js/54.50c55269.js"><link rel="prefetch" href="/blog/assets/js/55.9872afaf.js"><link rel="prefetch" href="/blog/assets/js/56.c65db65f.js"><link rel="prefetch" href="/blog/assets/js/57.f295d3a3.js"><link rel="prefetch" href="/blog/assets/js/58.646d74c2.js"><link rel="prefetch" href="/blog/assets/js/59.e5907b7f.js"><link rel="prefetch" href="/blog/assets/js/6.37d2ee2b.js"><link rel="prefetch" href="/blog/assets/js/60.110d12cb.js"><link rel="prefetch" href="/blog/assets/js/62.c777d48e.js"><link rel="prefetch" href="/blog/assets/js/63.ba4c03c0.js"><link rel="prefetch" href="/blog/assets/js/64.58a138da.js"><link rel="prefetch" href="/blog/assets/js/65.dbae2ec7.js"><link rel="prefetch" href="/blog/assets/js/66.7672dd29.js"><link rel="prefetch" href="/blog/assets/js/67.3bd3f2cd.js"><link rel="prefetch" href="/blog/assets/js/68.c3a9ff0e.js"><link rel="prefetch" href="/blog/assets/js/69.4b550dc1.js"><link rel="prefetch" href="/blog/assets/js/7.c28464d7.js"><link rel="prefetch" href="/blog/assets/js/70.60a80bb9.js"><link rel="prefetch" href="/blog/assets/js/71.e036146d.js"><link rel="prefetch" href="/blog/assets/js/72.fffbac90.js"><link rel="prefetch" href="/blog/assets/js/73.9c62cc20.js"><link rel="prefetch" href="/blog/assets/js/74.5cf56fa6.js"><link rel="prefetch" href="/blog/assets/js/75.921a7d44.js"><link rel="prefetch" href="/blog/assets/js/76.663992df.js"><link rel="prefetch" href="/blog/assets/js/77.1e7028b9.js"><link rel="prefetch" href="/blog/assets/js/78.4d0ec6aa.js"><link rel="prefetch" href="/blog/assets/js/79.9d7aa0da.js"><link rel="prefetch" href="/blog/assets/js/80.51e11255.js"><link rel="prefetch" href="/blog/assets/js/81.955a5574.js"><link rel="prefetch" href="/blog/assets/js/82.47d3d3ee.js"><link rel="prefetch" href="/blog/assets/js/83.ab2cf233.js"><link rel="prefetch" href="/blog/assets/js/84.c20f00e0.js"><link rel="prefetch" href="/blog/assets/js/85.9ecca68f.js"><link rel="prefetch" href="/blog/assets/js/86.bdd382ef.js"><link rel="prefetch" href="/blog/assets/js/87.e7878e79.js"><link rel="prefetch" href="/blog/assets/js/88.c647a438.js"><link rel="prefetch" href="/blog/assets/js/89.91aa57b1.js"><link rel="prefetch" href="/blog/assets/js/9.a80daa61.js"><link rel="prefetch" href="/blog/assets/js/90.e795fdf5.js"><link rel="prefetch" href="/blog/assets/js/91.e272b38a.js"><link rel="prefetch" href="/blog/assets/js/92.1688fdb1.js"><link rel="prefetch" href="/blog/assets/js/93.1e287375.js"><link rel="prefetch" href="/blog/assets/js/94.e3b194d0.js"><link rel="prefetch" href="/blog/assets/js/95.cdfad6b9.js"><link rel="prefetch" href="/blog/assets/js/96.0747758c.js"><link rel="prefetch" href="/blog/assets/js/97.a0f6ca09.js"><link rel="prefetch" href="/blog/assets/js/98.04a80961.js"><link rel="prefetch" href="/blog/assets/js/99.bd130839.js">
    <link rel="stylesheet" href="/blog/assets/css/0.styles.b17ddfa4.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/blog/" class="home-link router-link-active"><!----> <span class="site-name">Coderlhd的博客</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/blog/" class="nav-link">主页</a></div><div class="nav-item"><a href="/blog/pages/395573/" class="nav-link">Node</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端" class="dropdown-title"><a href="/blog/pages/9f8338/" class="link-title">前端</a> <span class="title" style="display:none;">前端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/pages/349798/" class="nav-link">CSS</a></li><li class="dropdown-item"><!----> <a href="/blog/pages/a194dc/" class="nav-link">HTML</a></li><li class="dropdown-item"><!----> <a href="/blog/pages/a845b1/" class="nav-link">JavaScript</a></li><li class="dropdown-item"><!----> <a href="/blog/pages/301f76/" class="nav-link">Tool</a></li><li class="dropdown-item"><!----> <a href="/blog/pages/ff4b06/" class="nav-link">ES6</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Vue技术揭秘" class="dropdown-title"><a href="/blog/pages/a47355/" class="link-title">Vue技术揭秘</a> <span class="title" style="display:none;">Vue技术揭秘</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/pages/a47355/" class="nav-link">v2.x版本</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="React技术揭秘" class="dropdown-title"><a href="/blog/pages/cb2f76/" class="link-title">React技术揭秘</a> <span class="title" style="display:none;">React技术揭秘</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/pages/cb2f76/" class="nav-link">理念篇</a></li><li class="dropdown-item"><!----> <a href="/blog/pages/37ee40/" class="nav-link">架构篇</a></li><li class="dropdown-item"><!----> <a href="/blog/pages/2c4132/" class="nav-link">实现篇</a></li></ul></div></div><div class="nav-item"><a href="/blog/pages/3d326e/" class="nav-link">数据库</a></div><div class="nav-item"><a href="/blog/pages/efa880/" class="nav-link">浏览器</a></div><div class="nav-item"><a href="/blog/pages/b8f048/" class="nav-link">面试问题</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="索引" class="dropdown-title"><!----> <span class="title" style="display:;">索引</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/archives/" class="nav-link">归档</a></li><li class="dropdown-item"><!----> <a href="/blog/tags/" class="nav-link">标签</a></li></ul></div></div><div class="nav-item"><a href="/blog/gpt/" class="nav-link">ChatGPT</a></div><div class="nav-item"><a href="/blog/experience/vue3/" class="nav-link">实践</a></div> <a href="https://github.com/2323152909/blog/" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><!----> <nav class="nav-links"><div class="nav-item"><a href="/blog/" class="nav-link">主页</a></div><div class="nav-item"><a href="/blog/pages/395573/" class="nav-link">Node</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端" class="dropdown-title"><a href="/blog/pages/9f8338/" class="link-title">前端</a> <span class="title" style="display:none;">前端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/pages/349798/" class="nav-link">CSS</a></li><li class="dropdown-item"><!----> <a href="/blog/pages/a194dc/" class="nav-link">HTML</a></li><li class="dropdown-item"><!----> <a href="/blog/pages/a845b1/" class="nav-link">JavaScript</a></li><li class="dropdown-item"><!----> <a href="/blog/pages/301f76/" class="nav-link">Tool</a></li><li class="dropdown-item"><!----> <a href="/blog/pages/ff4b06/" class="nav-link">ES6</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Vue技术揭秘" class="dropdown-title"><a href="/blog/pages/a47355/" class="link-title">Vue技术揭秘</a> <span class="title" style="display:none;">Vue技术揭秘</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/pages/a47355/" class="nav-link">v2.x版本</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="React技术揭秘" class="dropdown-title"><a href="/blog/pages/cb2f76/" class="link-title">React技术揭秘</a> <span class="title" style="display:none;">React技术揭秘</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/pages/cb2f76/" class="nav-link">理念篇</a></li><li class="dropdown-item"><!----> <a href="/blog/pages/37ee40/" class="nav-link">架构篇</a></li><li class="dropdown-item"><!----> <a href="/blog/pages/2c4132/" class="nav-link">实现篇</a></li></ul></div></div><div class="nav-item"><a href="/blog/pages/3d326e/" class="nav-link">数据库</a></div><div class="nav-item"><a href="/blog/pages/efa880/" class="nav-link">浏览器</a></div><div class="nav-item"><a href="/blog/pages/b8f048/" class="nav-link">面试问题</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="索引" class="dropdown-title"><!----> <span class="title" style="display:;">索引</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/archives/" class="nav-link">归档</a></li><li class="dropdown-item"><!----> <a href="/blog/tags/" class="nav-link">标签</a></li></ul></div></div><div class="nav-item"><a href="/blog/gpt/" class="nav-link">ChatGPT</a></div><div class="nav-item"><a href="/blog/experience/vue3/" class="nav-link">实践</a></div> <a href="https://github.com/2323152909/blog/" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><a href="/blog/pages/395573/" class="sidebar-link">看这里，能知道 Node.js 究竟是什么</a></li><li><a href="/blog/pages/d88369/" class="sidebar-link">Node事件循环</a></li><li><a href="/blog/pages/e6c643/" class="sidebar-link">Node核心模块 -文件路径path</a></li><li><a href="/blog/pages/d70e8e/" class="sidebar-link">Node核心模块 -fs模块</a></li><li><a href="/blog/pages/c6a888/" class="sidebar-link">Node.js中stream模块详解</a></li><li><a href="/blog/pages/9ccb29/" class="sidebar-link">Node.js核心模块-buffer</a></li><li><a href="/blog/pages/c9b4cb/" class="sidebar-link">深入理解Node.js 中的进程与线程</a></li><li><a href="/blog/pages/2a1999/" class="sidebar-link">消息队列助- Node.js实践篇</a></li><li><a href="/blog/pages/572769/" class="sidebar-link">Node.js 内存溢出时如何处理？</a></li><li><a href="/blog/pages/89c208/" class="sidebar-link">源码解读,一文彻底搞懂Events模块</a></li><li><a href="/blog/pages/2079d5/" class="sidebar-link">node.js十个常见误区</a></li><li><a href="/blog/pages/cdf306/" class="sidebar-link">使用 Node.js 搭建一个 API 网关(助力微服务)</a></li><li><a href="/blog/pages/bcb70a/" aria-current="page" class="active sidebar-link">Node与底层之间如何执行异步I/O调用</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level2"><a href="/blog/pages/bcb70a/#理解本文先要学习的几个概念" class="sidebar-link">理解本文先要学习的几个概念</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/blog/pages/bcb70a/#node-js-模块分类" class="sidebar-link">Node.js 模块分类</a></li><li class="sidebar-sub-header level3"><a href="/blog/pages/bcb70a/#libuv" class="sidebar-link">libuv</a></li><li class="sidebar-sub-header level3"><a href="/blog/pages/bcb70a/#iocp" class="sidebar-link">IOCP</a></li><li class="sidebar-sub-header level3"><a href="/blog/pages/bcb70a/#线程池" class="sidebar-link">线程池</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/blog/pages/bcb70a/#node-与底层之间的异步-i-o调用流程" class="sidebar-link">Node 与底层之间的异步 I/O调用流程</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/blog/pages/bcb70a/#事件循环" class="sidebar-link">事件循环</a></li><li class="sidebar-sub-header level3"><a href="/blog/pages/bcb70a/#底层调用与事件产生" class="sidebar-link">底层调用与事件产生</a></li><li class="sidebar-sub-header level4"><a href="/blog/pages/bcb70a/#file-i-o" class="sidebar-link">File I/O</a></li><li class="sidebar-sub-header level4"><a href="/blog/pages/bcb70a/#network-i-o" class="sidebar-link">Network I/O</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/blog/pages/bcb70a/#异步-i-o-助力-node-js-高性能" class="sidebar-link">异步 I/O 助力 Node.js 高性能</a></li><li class="sidebar-sub-header level2"><a href="/blog/pages/bcb70a/#参考" class="sidebar-link">参考</a></li></ul></li><li><a href="/blog/pages/b1572c/" class="sidebar-link">Node.js 进阶-你应该知道的 npm 知识都在这</a></li></ul> </aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-06225672><div class="articleInfo" data-v-06225672><ul class="breadcrumbs" data-v-06225672><li data-v-06225672><a href="/blog/" title="首页" class="iconfont icon-home router-link-active" data-v-06225672></a></li> <li data-v-06225672><span data-v-06225672>Nodejs</span></li></ul> <div class="info" data-v-06225672><div title="作者" class="author iconfont icon-touxiang" data-v-06225672><a href="https://github.com/2323152909" target="_blank" title="作者" class="beLink" data-v-06225672>coderlhd</a></div> <div title="创建时间" class="date iconfont icon-riqi" data-v-06225672><a href="javascript:;" data-v-06225672>2020-01-09</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-title">目录</div> <div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABKFJREFUSA3tVl1oFVcQnrMbrak3QUgkya1akpJYcrUtIqW1JvFBE9LiQ5v6JmJpolbMg32rVrhgoYK0QiMY6i9Y6EMaW5D+xFJaTYItIuK2Kr3+BJNwkxBj05sQY3b3nM6cs2dv9t7NT/vQJw/sndk5M/PNzJkzewGerP+pAmy+ON8lLzUJgA8ZYxYIYZmGYRnctDaWvJJAmTtfP1pvXsBCCPP8QFcCaRkZYACgDZFO4stNIcBCajEOlmmC9XpJ9bAGCaPaPmzPl32dvLSVu3BWCTQs0XQQ6g0DYgwLIoAZbBCdW/i+781o1VVlm/410mw4h06Y7bIPHNyWDyL4FHkX03Q8SrzNhZTZriieckWt7cL6MM85YcLpsi/7O9/iXFT6MswI0DmmpkSaJ0qLxFIm3+i1THHB3zmBH3PYx9CcykcLOeQVVa7QtdxTgQgEleX2AjHYfwA+2ddV77ruGoJUbhGDI09YSNXyMpUt5ylOzxgbUmtOp7NmbNt8v3arjTBfYELmLUV+M+nSawNNAUqpT3ClJWg5I3BLT+cGW/DXNGCa6tx1aakCGEigArTn4TDIPdrXXYKCZNrHLMCOEPvHBlLQ99s9eHB7EB6NTki73CVPQ2F5MSx/uRQixfmq7rK0wYD8w8E905bnPDfwoWs/rfv93NWN/ZfvwsLIU7A09gxECyISeGJkHAau98L97tuw7NXnoPyNF8FcYGLGKsOs0mN3OEyec9esGW/ZEl945dTP34wlR2FZVQWU1q0Cw8Tr7p+hgLLNL0FPxx/Q35mA8aEUrH6nCgwEl0tn7wUiZYJnNRh6DK4UH/k0lfyrsBKdPVv/AriGIQcEDQZ65LBAGe2Rzui9Ybjz7XUppz1/uKBbyVPGkN3ZAeC6hr0x7Nr38N5+EqkoOm17xpoqR9ohQF55ERSvr4Dkr3chNfC3DMzGJlNBElW8w9nsGQvhNGIzDkXzCg8cLK951xHsFBlTJspJNi3ZFIMF2AeDV3q8DNOB+YHi6QTrChDIWDBRi5U5f+ZMfJLu3ccrqxtdxk4SKH336LFxSmkqefwU5T8fhdSdQf9IVKD6aNiwI/hnmcAZ91isYMJIaCUCx9W098+LgruikeTqzqqxKPUwqJyCPJiyemVVZBOijDGjD38Os0jOiSPL1z3SPjXNANbiNPXAdzTfukjjuknNBbyz3nwgTd3AVFqUJ5hpHlq9MveLnWwttUfoygBmvVjuikxND3znrhsELnZk7k+OjIGxeNEkomyLVta0xxn+HZhjBc4YZ/AFjHjz9u3xRZl2BN4aq9nFwWh16IrQ1aHHEd3j1+4/dB9OtH4e29A2H1DyHQRmOSfQZ1Fy7MHBTGB6J/Djq6p3OxyO2cB+4Car7v/o3GXgfAkj23+x9ID1Teoamo/SXcbvSf2PX7Vc8DdCmE1vN9di+32P9/5YR3vLnhCVGUWBjEkr3yh4H8v9CzmsbdhzOKzsJKM90iFdaTMjRPhGVsakRvOaRidljo6H6G7j+ctrJpsP+4COhDIl0La2+FS4+5mlocBaXY5QnGZysIBYoeSsl5qQzrSj/cgNrfuEzlWBfwA+EjrZyWUvpAAAAABJRU5ErkJggg==">Node与底层之间如何执行异步I/O调用<!----></h1> <!----> <div class="theme-vdoing-content content__default"><p></p><div class="table-of-contents"><ul><li><a href="#理解本文先要学习的几个概念">理解本文先要学习的几个概念</a><ul><li><a href="#node-js-模块分类">Node.js 模块分类</a></li><li><a href="#libuv">libuv</a></li><li><a href="#iocp">IOCP</a></li><li><a href="#线程池">线程池</a></li></ul></li><li><a href="#node-与底层之间的-异步-i-o-调用流程">Node 与底层之间的异步 I/O调用流程</a><ul><li><a href="#事件循环">事件循环</a></li><li><a href="#底层调用与事件产生">底层调用与事件产生</a></li></ul></li><li><a href="#异步-i-o-助力-node-js-高性能">异步 I/O 助力 Node.js 高性能</a></li><li><a href="#参考">参考</a></li></ul></div><p></p> <p>本文你能学到：</p> <ul><li>Node.js 与底层之间是如何执行异步 I/O 调用的？和事件循环怎么联系上的呢？</li> <li>为什么说 Node 高性能，Node 的异步 I/O 对高性能助力了什么？</li> <li>Node 的事件循环，你对事件怎么理解？</li></ul> <blockquote><p>看完本文后，你应该能更好的去理解事件循环，知道事件是怎么来的，Node 究竟执行异步 I/O 调用。如果面试官再问事件循环还有 Node 与底层之间如何执行异步 I/O，我觉得你把本文的流程说清楚，应该能加分！本文对事件循环中的具体步骤没有详细讲解，每个步骤看官方文档更佳。</p></blockquote> <h2 id="理解本文先要学习的几个概念"><a href="#理解本文先要学习的几个概念" class="header-anchor">#</a> 理解本文先要学习的几个概念</h2> <h3 id="node-js-模块分类"><a href="#node-js-模块分类" class="header-anchor">#</a> Node.js 模块分类</h3> <p>nodejs 模块可以分为下面三类：</p> <ul><li>核心模块(native 模块)：包含在 Node.js 源码中，被编译进 Node.js 可执行二进制文件 JavaScript 模块，其实也就是 lib 和 deps 目录下的 js 文件，比如常用的 http,fs 等等。</li> <li>内建模块(built-in 模块)：一般我们不直接调用，而是在 native 模块中调用，然后我们再 require。</li> <li>第三方模块：非 Node.js 源码自带的模块都可以统称第三方模块，比如 express，webpack 等等。
<ul><li>JavaScript 模块，这是最常见的，我们开发的时候一般都写的是 JavaScript 模块</li> <li>JSON 模块，这个很简单，就是一个 JSON 文件</li> <li>C/C++ 扩展模块，使用 C/C++ 编写，编译之后后缀名为 .node</li></ul></li></ul> <p>比如 Node 源码 lib 目录下的 fs.js 就是 native 模块，而 fs.js 调用的 src 目录下的 node_fs.cc 就是内建模块。</p> <h3 id="libuv"><a href="#libuv" class="header-anchor">#</a> libuv</h3> <p>Libuv 是一个高性能的，事件驱动的异步 I/O 库，它本身是由 C 语言编写的，具有很高的可移植性。libuv 封装了不同平台底层对于异步 IO 模型的实现，libuv 的 API 包含有时间，非阻塞的网络，异步文件操作，子进程等等，所以它还本身具备着 Windows, Linux 都可使用的跨平台能力。</p> <p>经典 libuv 图(来源网上)</p> <h3 id="iocp"><a href="#iocp" class="header-anchor">#</a> IOCP</h3> <p>概念:输入输出完成端口（Input/Output Completion Port，IOCP）, 是支持多个同时发生的异步 I/O 操作的应用程序编程接口，在 Windows NT 的 3.5 版本以后，或 AIX5 版以后或 Solaris 第十版以后，开始支持。</p> <p>我直接这么说概念你可能也不太懂。可以暂时知道 Windows 下注意通过 IOCP 来向系统内核发送 I/O 调用和从内核获取已完成的 I/O 操作，配以事件循环，完成异步 I/O 的过程。在 linux 下通过 epoll 实现这个过程，也就是由 libuv 自行实现。</p> <p>IOCP 的另一个应用场景在之前 Node.js 进程与线程那篇文章也有写过。Mater 和 app worker 进程通信使用到。</p> <h3 id="线程池"><a href="#线程池" class="header-anchor">#</a> 线程池</h3> <p>线程池，是一种线程的使用模式，它为了降低线程使用中频繁的创建和销毁所带来的资源消耗与代价。
通过创建一定数量的线程，让他们时刻准备就绪等待新任务的到达，而任务执行结束之后再重新回来继续待命。</p> <p>这就是线程池最核心的设计思路，「复用线程，平摊线程的创建与销毁的开销代价」。</p> <p>本文使用到线程池的地方:在 Node 中，无论是 *nix 还是 Window 平台。内部完成 I/O 任务的都有用到线程池。</p> <p>libuv 目前使用了一个全局的线程池，所有的循环都可以往其中加入任务。目前有三种操作会在这个线程池中执行：</p> <ul><li><p>文件系统操作</p></li> <li><p>DNS 函数（getaddrinfo 和 getnameinfo）</p></li> <li><p>通过 uv_queue_work() 添加的用户代码</p></li></ul> <h2 id="node-与底层之间的异步-i-o调用流程"><a href="#node-与底层之间的异步-i-o调用流程" class="header-anchor">#</a> Node 与底层之间的<strong>异步 I/O</strong>调用流程</h2> <p>对比图中两段经典 api 代码(<code>server.listen</code>和<code>fs.open</code>，选择两种 api 的原因：网络 I/O 代表和文件 I/O 代表)和之前 libuv 图片，我们来一起理解异步 I/O 调用流程</p> <p>上图展示了 libuv 细节的流程，图中代码很简单，包括 2 个部分：</p> <ol><li><p>server.listen() 是用来创建 TCP server 时，通常放在最后一步执行的代码。主要指定服务器工作的端口以及回调函数。</p></li> <li><p>fs.open() 是用异步的方式打开一个文件。</p></li></ol> <p>选择两个示例很简单，因为 libuv 架构图可视：libuv 对 Network I/O 和 File I/O 采用不同的机制。</p> <p>上图右半部分，主要分成两个部分：</p> <ol><li><p>主线程：主线程也是 node 启动时执行的现成。node 启动时，会完成一系列的初始化动作，启动 V8 engine，进入下一个循环。</p></li> <li><p>线程池：线程池的数量可以通过环境变量 UV_THREADPOOL_SIZE 配置，最大不超过 128 个，默认为 4 个。</p></li></ol> <blockquote><p><strong>在 Node.js 中经典的代码调用方式：都是从 JavaScript 调用 Node 核心模块，核心模块调用 C++ 内建模块，内建模块通过 libuv 进行系统调用。请记住这段话</strong></p></blockquote> <h3 id="事件循环"><a href="#事件循环" class="header-anchor">#</a> 事件循环</h3> <p>不管是<code>server.listen</code>还是<code>fs.open</code>，他们在开启一个 node 服务(进程)的时候，Node 会创建一个 while(true)的循环，这个循环就是事件循环。每执行一次循环体的过程，我们称之为 Tick。每个 Tick 的过程就是<strong>查看是否有事件待处理</strong>，如果有，就取出事件及其相关的回调函数。如果存在关联的回调函数，就执行。然后进入下一个循环，如果不再有事件处理，退出进程。</p> <p>这里我们知道事件循环已经创建了，上面加粗字体查看<strong>是否有事件待处理，去哪里查看？事件怎么进入事件循环的？什么情况会产生事件继续往下看</strong>。</p> <h3 id="底层调用与事件产生"><a href="#底层调用与事件产生" class="header-anchor">#</a> 底层调用与事件产生</h3> <p>继续看这张图，讲解一下事件产生基本流程，（注意网络 I/O 和文件 I/O 会有一些不同）这里对 c++代码调用简单提一下，有兴趣的小伙伴可以继续深入研究。</p> <h4 id="file-i-o"><a href="#file-i-o" class="header-anchor">#</a> File I/O</h4> <p>（这里就用到了文初提到的模块分类知识）先是 javascript 代码，然后调用 <code>lib/fs.js</code> 核心模块代码 <code>fs.open</code> ，核心模块调用 C++ 内建模块 <code>src/node_file.cc</code>，内建模块 c++代码会有一个平台判断，然后通过 libuv 进行系统调用。</p> <p>从前面到达 libuv ，会有一个参数，<strong>请求对象</strong>，也就是 open 函数前面整个流程传递进来的请求对象，它保存了所有状态，包括送入线程池等待执行以及 I/O 操作完毕后的回调处理。</p> <p>请求对象组装完成后，送入 libuv 中创建的 I/O 线程池，线程池中的 I/O 操作完毕后，会将获取的结果存储到 req-&gt;result 属性上，然后通知某函数通知 <strong>IOCP</strong> ，告知当前对象操作已经完成。</p> <p>在这整个过程中，进程初期创建的事件循环中有一个 I/O 观察者，每次 Tick 的执行中，它会调用 IOCP 相关的方法检查线程池中是否有执行完成的请求，如果存在，会讲请求对象和之前绑定的 result 属性，加入到 I/O 观察者的队列中，然后将其当作事件处理。</p> <blockquote><p>看到这里，前面提到的**是否有事件待处理，去哪里查看？事件怎么进入事件循环的？**这两个问题是不是搞懂了。</p></blockquote> <p>文字配上图。更清晰！</p> <h4 id="network-i-o"><a href="#network-i-o" class="header-anchor">#</a> Network I/O</h4> <p>V8 engine 执行从 <code>server.listen()</code> 开始，调用 <code>builtin module Tcp_wrap</code> 的过程。</p> <p>在创建 TCP 链接的过程中，libuv 直接参与<code>Tcp_wrap.cc</code>函数中的 <code>TCPWrap::listen()</code> 调用 uv_listen()开始到执行<code>uv_io_start()</code>结束。看起来很短暂的过程，其实是类似 linux kernel 的中断处理机制。</p> <p><code>uv_io_start()</code>负载将 handle 插入到处理的<code>water queue</code>中。这样的好处是请求能够立即得到处理。中断处理机制里面的下半部分与数据处理操作相似，交由主线程去完成处理。</p> <blockquote><p>重要：虽然 libuv 的异步文件 I/O 操作是通过线程池实现的，但是网络 I/O 总是在单线程中执行的，注意最后还是会把完成的内容作为事件加入事件循环，事件循环就和文件 I/O 相同了。</p></blockquote> <h2 id="异步-i-o-助力-node-js-高性能"><a href="#异步-i-o-助力-node-js-高性能" class="header-anchor">#</a> 异步 I/O 助力 Node.js 高性能</h2> <p>传统的服务器模型</p> <ul><li>同步式: 同步的服务，一次只能处理一个请求，并且其余请求都处于等待状态。</li> <li>每进程/每请求: 为每个请求启动一个进程，这样可以处理多个请求，但是不具有扩展性，系统资源有限，开启太多进程不太合适</li> <li>每线程/每请求: 为每个请求启动一个线程来处理。尽管线程比进程轻量，但是每个线程也都会占用一定内存，当大并发请求的时候，也会占用很大内存，导致服务器缓慢。</li></ul> <p><strong>Node 就不一样了！</strong></p> <p>看了文章前面的内容，Node 通过事件驱动的方式处理请求，无需为每个请求创建额外的对应线程，可以省掉<strong>创建线程和销毁线程</strong>的开销，同时操作系统在调度任务时因为线程较少，<strong>上下文切换</strong>的代价很低。这也是 Node.js 高性能之一</p> <blockquote><p>Nginx 目前也采用了和 Node 相同的事件驱动方式，有兴趣的也去了解下，不过 Nginx 采用 c 语言编写。</p></blockquote> <h2 id="参考"><a href="#参考" class="header-anchor">#</a> 参考</h2> <p>本文很多内容来自朴灵老师的 《深入浅出 Node.js》，这本书虽然出版很久了，给我的感觉还是越看越香,自己可以边看边扩展，推荐。</p> <p>Libuv 学习——文件处理
https://zhuanlan.zhihu.com/p/97789391</p> <p>高性能异步 I/O 模型库 libuv 设计思路概述
https://blog.csdn.net/ababab12345/article/details/103951026</p></div></div> <!----> <div class="page-edit"><div class="edit-link"><a href="https://github.com/2323152909/blog/edit/master/docs/05.Nodejs/13.Node与底层之间如何执行异步调用.md" target="_blank" rel="noopener noreferrer">编辑</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="tags"><a href="/blog/tags/?tag=Node.js" title="标签">#Node.js</a><a href="/blog/tags/?tag=%E5%BC%82%E6%AD%A5I%2FO" title="标签">#异步I/O</a></div> <!----></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><a href="/blog/pages/cdf306/" class="page-nav-centre page-nav-centre-prev"><div class="tooltip">使用 Node.js 搭建一个 API 网关(助力微服务)</div></a> <a href="/blog/pages/b1572c/" class="page-nav-centre page-nav-centre-next"><div class="tooltip">Node.js 进阶-你应该知道的 npm 知识都在这</div></a></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/blog/pages/cdf306/" class="prev">使用 Node.js 搭建一个 API 网关(助力微服务)</a></span> <span class="next"><a href="/blog/pages/b1572c/">Node.js 进阶-你应该知道的 npm 知识都在这</a>→
      </span></p></div></div></div> <div class="article-list"><div class="article-title"><a href="/blog/archives/" class="iconfont icon-bi">最近更新</a></div> <div class="article-wrapper"><dl><dd>01</dd> <dt><a href="/blog/pages/a47355/"><div>
            Introduction
            <!----></div></a> <span class="date">05-25</span></dt></dl><dl><dd>02</dd> <dt><a href="/blog/pages/2ebf68/"><div>
            Vue.js源码目录设计
            <!----></div></a> <span class="date">05-25</span></dt></dl><dl><dd>03</dd> <dt><a href="/blog/pages/71938f/"><div>
            认识Flow
            <!----></div></a> <span class="date">05-25</span></dt></dl> <dl><dd></dd> <dt><a href="/blog/archives/" class="more">更多文章&gt;</a></dt></dl></div></div></main></div> <div class="footer"><div class="icons"><a href="mailto:15123603553@163.com" title="邮件" target="_blank" class="iconfont icon-youjian"></a><a href="https://github.com/2323152909" title="GitHub" target="_blank" class="iconfont icon-github"></a></div> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主题">Vdoing</a> 
    | Copyright © 2023-2023
    <span>coderlhd | <a href="https://github.com/2323152909/blob/master/LICENSE" target="_blank">MIT License</a><br> <a href="https://beian.miit.gov.cn/#/Integrated/index" target="_blank">渝ICP备2022003847号-2</a></span></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          跟随系统
        </li><li class="iconfont icon-rijianmoshi">
          浅色模式
        </li><li class="iconfont icon-yejianmoshi">
          深色模式
        </li><li class="iconfont icon-yuedu">
          阅读模式
        </li></ul></div></div> <!----> <!----> <!----></div><div class="global-ui"><div></div><!----><div></div></div></div>
    <script src="/blog/assets/js/app.200a69ba.js" defer></script><script src="/blog/assets/js/2.63aefd49.js" defer></script><script src="/blog/assets/js/61.6fb6de0d.js" defer></script><script src="/blog/assets/js/5.324b4591.js" defer></script><script src="/blog/assets/js/8.19393a5e.js" defer></script>
  </body>
</html>
